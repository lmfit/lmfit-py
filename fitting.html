<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Performing Fits, Analyzing Outputs &mdash; Non-Linear Least-Squares Minimization and Curve-Fitting for Python</title>
    
    <link rel="stylesheet" href="_static/lmfitdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8.0rc4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Non-Linear Least-Squares Minimization and Curve-Fitting for Python" href="index.html" />
    <link rel="next" title="Modeling Data and Curve Fitting" href="model.html" />
    <link rel="prev" title="Parameter and Parameters" href="parameters.html" />
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
        "TeX": {Macros: {AA : "{\\unicode{x212B}}"}},
        "HTML-CSS": {scale: 90}
  });</script>

  </head>
  <body>
<div>
<table border=0>
  <tr><td></td><td width=75% padding=5 align=left>
       <a href="index.html" style="color: #157"> <font size=+3>LMFIT</font></a>
     </td><td></td>
     <td width=8% align=left>
         <a href="contents.html" style="color: #882222">
         <font size+=1>Contents</font></a> </td>
     <td width=8% align=left>
          <a href="installation.html" style="color: #882222">
          <font size+=1>Download</font></a></td>
     <td width=8% align=left>
        <a href="https://github.com/lmfit/lmfit-py/" style="color: #882222">
         <font size+=1>Develop</font></a></td>
  </tr>
  <tr><td></td><td width=75% padding=5 align=left>
        <a href="index.html" style="color: #157"> <font size=+2>
	Non-Linear Least-Squares Minimization and Curve-Fitting for Python</font></a>
     </td><td></td>
     <td width=8% align=left>
         <a href="intro.html" style="color: #882222">
         <font size+=1>Introduction</font></a> </td>
     <td width=8% align=left>
         <a href="parameters.html" style="color: #882222">
         <font size+=1>Parameters</font></a> </td>
     <td width=8% align=left>
         <a href="model.html" style="color: #882222">
         <font size+=1>Models</font></a> </td>

  </tr>
</table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="model.html" title="Modeling Data and Curve Fitting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parameters.html" title="Parameter and Parameters"
             accesskey="P">previous</a> |</li>
   <li>[<a href="intro.html">intro</a>|</li>
   <li><a href="parameters.html">parameters</a>|</li>
   <li><a href="#"> minimize</a>|</li>
   <li><a href="model.html"> model</a>|</li>
   <li><a href="builtin_models.html"> builtin models</a>|</li>
   <li><a href="confidence.html">confidence intervals</a>|</li>
   <li><a href="bounds.html">bounds</a>|</li>
   <li><a href="constraints.html">constraints</a>]</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Performing Fits, Analyzing Outputs</a><ul>
<li><a class="reference internal" href="#the-minimize-function">The <tt class="docutils literal"><span class="pre">minimize()</span></tt> function</a></li>
<li><a class="reference internal" href="#writing-a-fitting-function">Writing a Fitting Function</a></li>
<li><a class="reference internal" href="#choosing-different-fitting-methods">Choosing Different Fitting Methods</a></li>
<li><a class="reference internal" href="#goodness-of-fit-and-estimated-uncertainty-and-correlations">Goodness-of-Fit and estimated uncertainty and correlations</a></li>
<li><a class="reference internal" href="#using-the-minimizer-class">Using the <tt class="docutils literal"><span class="pre">Minimizer</span></tt> class</a></li>
<li><a class="reference internal" href="#getting-and-printing-fit-reports">Getting and Printing Fit Reports</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parameters.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">Parameter</span></tt>  and <tt class="docutils literal"><span class="pre">Parameters</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="model.html"
                        title="next chapter">Modeling Data and Curve Fitting</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/fitting.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="performing-fits-analyzing-outputs">
<span id="minimize-chapter"></span><h1>Performing Fits, Analyzing Outputs<a class="headerlink" href="#performing-fits-analyzing-outputs" title="Permalink to this headline">¶</a></h1>
<p>As shown in the previous chapter, a simple fit can be performed with the
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function.  For more sophisticated modeling, the
<a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class can be used to gain a bit more control, especially
when using complicated constraints.</p>
<div class="section" id="the-minimize-function">
<h2>The <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function<a class="headerlink" href="#the-minimize-function" title="Permalink to this headline">¶</a></h2>
<p>The minimize function takes a objective function (the function that
calculates the array to be minimized), a <tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt> ordered
dictionary, and several optional arguments.  See <a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for
details on writing the function to minimize.</p>
<dl class="function">
<dt id="minimize">
<tt class="descname">minimize</tt><big>(</big><em>function</em>, <em>params</em><span class="optional">[</span>, <em>args=None</em><span class="optional">[</span>, <em>kws=None</em><span class="optional">[</span>, <em>method='leastsq'</em><span class="optional">[</span>, <em>scale_covar=True</em><span class="optional">[</span>, <em>iter_cb=None</em><span class="optional">[</span>, <em>**leastsq_kws</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>find values for the <tt class="docutils literal"><span class="pre">params</span></tt> so that the sum-of-squares of the array returned
from <tt class="docutils literal"><span class="pre">function</span></tt> is minimized.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>function</strong> (<em>callable.</em>) &#8211; function to return fit residual.  See <a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for details.</li>
<li><strong>params</strong> (dict or <tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt>.) &#8211; a <tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt> dictionary.  Keywords must be strings
that match <tt class="docutils literal"><span class="pre">[a-z_][a-z0-9_]*</span></tt> and is not a python
reserved word.  Each value must be <tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt>.</li>
<li><strong>args</strong> (<a class="reference external" href="http://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) &#8211; arguments tuple to pass to the residual function as  positional arguments.</li>
<li><strong>kws</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; dictionary to pass to the residual function as keyword arguments.</li>
<li><strong>method</strong> (string (default <tt class="docutils literal"><span class="pre">leastsq</span></tt>)) &#8211; name of fitting method to use. See  <a class="reference internal" href="#fit-methods-label"><em>Choosing Different Fitting Methods</em></a> for details</li>
<li><strong>scale_covar</strong> (bool (default <tt class="docutils literal"><span class="pre">True</span></tt>)) &#8211; whether to automatically scale covariance matrix (<tt class="docutils literal"><span class="pre">leastsq</span></tt> only)</li>
<li><strong>iter_cb</strong> (callable or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; function to be called at each fit iteration</li>
<li><strong>leastsq_kws</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; dictionary to pass to <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.leastsq()</span></tt></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Minimizer object, which can be used to inspect goodness-of-fit
statistics, or to re-run fit.</p>
</td>
</tr>
</tbody>
</table>
<p>On output, the params will be updated with best-fit values and, where
appropriate, estimated uncertainties and correlations.  See
<a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a> for further details.</p>
<p>If provided, the <tt class="docutils literal"><span class="pre">iter_cb</span></tt> function should take arguments of <tt class="docutils literal"><span class="pre">params,</span>
<span class="pre">iter,</span> <span class="pre">resid,</span> <span class="pre">*args,</span> <span class="pre">**kws</span></tt>, where <tt class="docutils literal"><span class="pre">params</span></tt> will have the current
parameter values, <tt class="docutils literal"><span class="pre">iter</span></tt> the iteration, <tt class="docutils literal"><span class="pre">resid</span></tt> the current residual
array, and <tt class="docutils literal"><span class="pre">*args</span></tt> and <tt class="docutils literal"><span class="pre">**kws</span></tt> as passed to the objective function.</p>
</dd></dl>

</div>
<div class="section" id="writing-a-fitting-function">
<span id="fit-func-label"></span><h2>Writing a Fitting Function<a class="headerlink" href="#writing-a-fitting-function" title="Permalink to this headline">¶</a></h2>
<p>An important component of a fit is writing a function to be minimized &#8211;
the <em>objective function</em>.  Since this function will be called by other
routines, there are fairly stringent requirements for its call signature
and return value.  In principle, your function can be any python callable,
but it must look like this:</p>
<dl class="function">
<dt>
<tt class="descname">func(params, *args, **kws):</tt></dt>
<dd><p>calculate objective residual to be minimized from parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>params</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; parameters.</li>
<li><strong>args</strong> &#8211; positional arguments.  Must match <tt class="docutils literal"><span class="pre">args</span></tt> argument to <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></li>
<li><strong>kws</strong> &#8211; keyword arguments.  Must match <tt class="docutils literal"><span class="pre">kws</span></tt> argument to <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">residual array (generally data-model) to be minimized in the least-squares sense.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy array.  The length of this array cannot change between calls.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A common use for the positional and keyword arguments would be to pass in other
data needed to calculate the residual, including such things as the data array,
dependent variable, uncertainties in the data, and other data structures for the
model calculation.</p>
<p>The objective function should return the value to be minimized.  For the
Levenberg-Marquardt algorithm from <tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt>, this returned value <strong>must</strong> be an
array, with a length greater than or equal to the number of fitting variables in the
model.  For the other methods, the return value can either be a scalar or an array.  If an
array is returned, the sum of squares of the array will be sent to the underlying fitting
method, effectively doing a least-squares optimization of the return values.</p>
<p>Since the function will be passed in a dictionary of <tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt>, it is advisable
to unpack these to get numerical values at the top of the function.  A
simple way to do this is with <tt class="xref py py-meth docutils literal"><span class="pre">Parameters.valuesdict()</span></tt>, as with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># unpack parameters:</span>
    <span class="c">#  extract .value attribute for each parameter</span>
    <span class="n">parvals</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">()</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">parvals</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">parvals</span><span class="p">[</span><span class="s">&#39;shift&#39;</span><span class="p">]</span>
    <span class="n">decay</span> <span class="o">=</span> <span class="n">parvals</span><span class="p">[</span><span class="s">&#39;decay&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">sign</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e-10</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">parvals</span><span class="p">[</span><span class="s">&#39;amp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">decay</span><span class="o">*</span><span class="n">decay</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span>
    <span class="k">if</span> <span class="n">eps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">eps</span>
</pre></div>
</div>
<p>In this example, <tt class="docutils literal"><span class="pre">x</span></tt> is a positional (required) argument, while the
<tt class="docutils literal"><span class="pre">data</span></tt> array is actually optional (so that the function returns the model
calculation if the data is neglected).  Also note that the model
calculation will divide <tt class="docutils literal"><span class="pre">x</span></tt> by the value of the &#8216;period&#8217; Parameter.  It
might be wise to ensure this parameter cannot be 0.  It would be possible
to use the bounds on the <tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt> to do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">params</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">)</span>
</pre></div>
</div>
<p>but putting this directly in the function with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e-10</span>
</pre></div>
</div>
<p>is also a reasonable approach.   Similarly, one could place bounds on the
<tt class="docutils literal"><span class="pre">decay</span></tt> parameter to take values only between <tt class="docutils literal"><span class="pre">-pi/2</span></tt> and <tt class="docutils literal"><span class="pre">pi/2</span></tt>.</p>
</div>
<div class="section" id="choosing-different-fitting-methods">
<span id="fit-methods-label"></span><h2>Choosing Different Fitting Methods<a class="headerlink" href="#choosing-different-fitting-methods" title="Permalink to this headline">¶</a></h2>
<p>By default, the <a class="reference external" href="http://en.wikipedia.org/wiki/Levenberg-Marquardt_algorithm">Levenberg-Marquardt</a> algorithm is
used for fitting.  While often criticized, including the fact it finds a
<em>local</em> minima, this approach has some distinct advantages.  These include
being fast, and well-behaved for most curve-fitting needs, and making it
easy to estimate uncertainties for and correlations between pairs of fit
variables, as discussed in <a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a>.</p>
<p>Alternative algorithms can also be used by providing the <tt class="docutils literal"><span class="pre">method</span></tt> keyword
to the <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function or use the corresponding method name from
the <a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class as listed in the <a class="reference internal" href="#fit-methods-table"><em>Table of Supported
Fitting Methods</em></a>.</p>
<blockquote id="fit-methods-table">
<div><p>Table of Supported Fitting Methods:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="22%" />
<col width="24%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fitting
Method</th>
<th class="head"><tt class="docutils literal"><span class="pre">method</span></tt> arg to
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></th>
<th class="head"><a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a>
method</th>
<th class="head"><tt class="docutils literal"><span class="pre">method</span></tt> arg to
<tt class="xref py py-meth docutils literal"><span class="pre">scalar_minimize()</span></tt></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Levenberg-Marquardt</td>
<td><tt class="docutils literal"><span class="pre">leastsq</span></tt></td>
<td><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></td>
<td>Not available</td>
</tr>
<tr class="row-odd"><td>Nelder-Mead</td>
<td><tt class="docutils literal"><span class="pre">nelder</span></tt></td>
<td><tt class="xref py py-meth docutils literal"><span class="pre">fmin()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Nelder-Mead</span></tt></td>
</tr>
<tr class="row-even"><td>L-BFGS-B</td>
<td><tt class="docutils literal"><span class="pre">lbfgsb</span></tt></td>
<td><tt class="xref py py-meth docutils literal"><span class="pre">lbfgsb()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">L-BFGS-B</span></tt></td>
</tr>
<tr class="row-odd"><td>Powell</td>
<td><tt class="docutils literal"><span class="pre">powell</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">Powell</span></tt></td>
</tr>
<tr class="row-even"><td>Conjugate Gradient</td>
<td><tt class="docutils literal"><span class="pre">cg</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">CG</span></tt></td>
</tr>
<tr class="row-odd"><td>Newton-CG</td>
<td><tt class="docutils literal"><span class="pre">newton</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">Newton-CG</span></tt></td>
</tr>
<tr class="row-even"><td>COBYLA</td>
<td><tt class="docutils literal"><span class="pre">cobyla</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">COBYLA</span></tt></td>
</tr>
<tr class="row-odd"><td>COBYLA</td>
<td><tt class="docutils literal"><span class="pre">cobyla</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">COBYLA</span></tt></td>
</tr>
<tr class="row-even"><td>Truncated Newton</td>
<td><tt class="docutils literal"><span class="pre">tnc</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">TNC</span></tt></td>
</tr>
<tr class="row-odd"><td>Trust Newton-CGn</td>
<td><tt class="docutils literal"><span class="pre">trust-ncg</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">trust-ncg</span></tt></td>
</tr>
<tr class="row-even"><td>Dogleg</td>
<td><tt class="docutils literal"><span class="pre">dogleg</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">dogleg</span></tt></td>
</tr>
<tr class="row-odd"><td>Sequential Linear
Squares Programming</td>
<td><tt class="docutils literal"><span class="pre">slsqp</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">SLSQP</span></tt></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The objective function for the Levenberg-Marquardt method <strong>must</strong>
return an array, with more elements than variables.  All other methods
can return either a scalar value or an array.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Much of this documentation assumes that the Levenberg-Marquardt method is
the method used.  Many of the fit statistics and estimates for
uncertainties in parameters discussed in <a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a> are
done only for this method.</p>
</div>
</div>
<div class="section" id="goodness-of-fit-and-estimated-uncertainty-and-correlations">
<span id="fit-results-label"></span><h2>Goodness-of-Fit and estimated uncertainty and correlations<a class="headerlink" href="#goodness-of-fit-and-estimated-uncertainty-and-correlations" title="Permalink to this headline">¶</a></h2>
<p>On a successful fit using the <cite>leastsq</cite> method, several goodness-of-fit
statistics and values related to the uncertainty in the fitted variables will be
calculated.  These are all encapsulated in the <a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object for the
fit, as returned by <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>.  The values related to the entire fit are
stored in attributes of the <a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object, as shown in <a class="reference internal" href="#goodfit-table"><em>Table
of Fit Results</em></a> while those related to each fitted variables are
stored as attributes of the corresponding <tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt>.</p>
<blockquote id="goodfit-table">
<div>Table of Fit Results:  These values, including the standard Goodness-of-Fit statistics,
are all attributes of the <a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object returned by <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>.</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a>
Attribute</th>
<th class="head">Description / Formula</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nfev</td>
<td>number of function evaluations</td>
</tr>
<tr class="row-odd"><td>success</td>
<td>boolean (<tt class="docutils literal"><span class="pre">True</span></tt>/<tt class="docutils literal"><span class="pre">False</span></tt>) for whether fit succeeded.</td>
</tr>
<tr class="row-even"><td>errorbars</td>
<td>boolean (<tt class="docutils literal"><span class="pre">True</span></tt>/<tt class="docutils literal"><span class="pre">False</span></tt>) for whether uncertainties were estimated.</td>
</tr>
<tr class="row-odd"><td>message</td>
<td>message about fit success.</td>
</tr>
<tr class="row-even"><td>ier</td>
<td>integer error value from <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.leastsq()</span></tt></a></td>
</tr>
<tr class="row-odd"><td>lmdif_message</td>
<td>message from <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.leastsq()</span></tt></a></td>
</tr>
<tr class="row-even"><td>nvarys</td>
<td>number of variables in fit  <span class="math">\(N_{\rm varys}\)</span></td>
</tr>
<tr class="row-odd"><td>ndata</td>
<td>number of data points:  <span class="math">\(N\)</span></td>
</tr>
<tr class="row-even"><td>nfree `</td>
<td>degrees of freedom in fit:  <span class="math">\(N - N_{\rm varys}\)</span></td>
</tr>
<tr class="row-odd"><td>residual</td>
<td>residual array (return of <tt class="xref py py-func docutils literal"><span class="pre">func()</span></tt>:  <span class="math">\({\rm Resid}\)</span></td>
</tr>
<tr class="row-even"><td>chisqr</td>
<td>chi-square: <span class="math">\(\chi^2 = \sum_i^N [{\rm Resid}_i]^2\)</span></td>
</tr>
<tr class="row-odd"><td>redchi</td>
<td>reduced chi-square: <span class="math">\(\chi^2_{\nu}= {\chi^2} / {(N - N_{\rm varys})}\)</span></td>
</tr>
<tr class="row-even"><td>var_map</td>
<td>list of variable parameter names for rows/columns of covar</td>
</tr>
<tr class="row-odd"><td>covar</td>
<td>covariance matrix (with rows/columns using var_map</td>
</tr>
</tbody>
</table>
<p>Note that the calculation of chi-square and reduced chi-square assume that the
returned residual function is scaled properly to the uncertainties in the data.
For these statistics to be meaningful, the person writing the function to
be minimized must scale them properly.</p>
<p>After a fit using using the <tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt> method has completed successfully,
standard errors for the fitted variables and correlations between pairs of
fitted variables are automatically calculated from the covariance matrix.
The standard error (estimated <span class="math">\(1\sigma\)</span> error-bar) go into the
<tt class="xref py py-attr docutils literal"><span class="pre">stderr</span></tt> attribute of the Parameter.  The correlations with all other
variables will be put into the <tt class="xref py py-attr docutils literal"><span class="pre">correl</span></tt> attribute of the Parameter &#8211;
a dictionary with keys for all other Parameters and values of the
corresponding correlation.</p>
<p>In some cases, it may not be possible to estimate the errors and
correlations.  For example, if a variable actually has no practical effect
on the fit, it will likely cause the covariance matrix to be singular,
making standard errors impossible to estimate.  Placing bounds on varied
Parameters makes it more likely that errors cannot be estimated, as being
near the maximum or minimum value makes the covariance matrix singular.  In
these cases, the <tt class="xref py py-attr docutils literal"><span class="pre">errorbars</span></tt> attribute of the fit result
(<a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object) will be <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
<span class="target" id="module-Minimizer"></span></div>
<div class="section" id="using-the-minimizer-class">
<span id="fit-minimizer-label"></span><h2>Using the <a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class<a class="headerlink" href="#using-the-minimizer-class" title="Permalink to this headline">¶</a></h2>
<p>For full control of the fitting process, you&#8217;ll want to create a
<a class="reference internal" href="#module-Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object, or at least use the one returned from the
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function.</p>
<dl class="class">
<dt id="Minimizer.Minimizer">
<em class="property">class </em><tt class="descname">Minimizer</tt><big>(</big><em>function</em>, <em>params</em>, <em>fcn_args=None</em>, <em>fcn_kws=None</em>, <em>iter_cb=None</em>, <em>scale_covar=True</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.Minimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>creates a Minimizer, for fine-grain access to fitting methods and attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>function</strong> (<em>callable.</em>) &#8211; objective function to return fit residual.  See <a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for details.</li>
<li><strong>params</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; a dictionary of Parameters.  Keywords must be strings
that match <tt class="docutils literal"><span class="pre">[a-z_][a-z0-9_]*</span></tt> and is not a python
reserved word.  Each value must be <tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt>.</li>
<li><strong>fcn_args</strong> (<a class="reference external" href="http://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) &#8211; arguments tuple to pass to the residual function as  positional arguments.</li>
<li><strong>fcn_kws</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; dictionary to pass to the residual function as keyword arguments.</li>
<li><strong>iter_cb</strong> (callable or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; function to be called at each fit iteration</li>
<li><strong>scale_covar</strong> &#8211; flag for automatically scaling covariance matrix and uncertainties to reduced chi-square (<tt class="docutils literal"><span class="pre">leastsq</span></tt> only)</li>
<li><strong>kws</strong> (<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; dictionary to pass as keywords to the underlying <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/optimize.html#module-scipy.optimize" title="(in SciPy v0.14.0)"><tt class="xref py py-mod docutils literal"><span class="pre">scipy.optimize</span></tt></a> method.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Minimizer object, which can be used to inspect goodness-of-fit
statistics, or to re-run fit.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The Minimizer object has a few public methods:</p>
<dl class="method">
<dt id="Minimizer.leastsq">
<tt class="descname">leastsq</tt><big>(</big><em>scale_covar=True</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.leastsq" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with Levenberg-Marquardt algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.leastsq()</span></tt></a>.
By default, numerical derivatives are used, and the following arguments are set:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#Minimizer.leastsq" title="Minimizer.leastsq"><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xtol</td>
<td>1.e-7</td>
<td>Relative error in the approximate solution</td>
</tr>
<tr class="row-odd"><td>ftol</td>
<td>1.e-7</td>
<td>Relative error in the desired sum of squares</td>
</tr>
<tr class="row-even"><td>maxfev</td>
<td>2000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
<tr class="row-odd"><td>Dfun</td>
<td><tt class="docutils literal"><span class="pre">None</span></tt></td>
<td>function to call for Jacobian calculation</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="Minimizer.lbfgsb">
<tt class="descname">lbfgsb</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.lbfgsb" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with L-BFGS-B algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin_l_bfgs_b.html#scipy.optimize.fmin_l_bfgs_b" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.fmin_l_bfgs_b()</span></tt></a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#Minimizer.lbfgsb" title="Minimizer.lbfgsb"><tt class="xref py py-meth docutils literal"><span class="pre">lbfgsb()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>factr</td>
<td>1000.0</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>approx_grad</td>
<td><tt class="docutils literal"><span class="pre">True</span></tt></td>
<td>calculate approximations of gradient</td>
</tr>
<tr class="row-even"><td>maxfun</td>
<td>2000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="Minimizer.fmin">
<tt class="descname">fmin</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.fmin" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with Nelder-Mead downhill simplex algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin.html#scipy.optimize.fmin" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.fmin()</span></tt></a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#Minimizer.fmin" title="Minimizer.fmin"><tt class="xref py py-meth docutils literal"><span class="pre">fmin()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ftol</td>
<td>1.e-4</td>
<td>function tolerance</td>
</tr>
<tr class="row-odd"><td>xtol</td>
<td>1.e-4</td>
<td>parameter tolerance</td>
</tr>
<tr class="row-even"><td>maxfun</td>
<td>5000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="Minimizer.scalar_minimize">
<tt class="descname">scalar_minimize</tt><big>(</big><em>method='Nelder-Mead'</em>, <em>hess=None</em>, <em>tol=None</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.scalar_minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with any of the scalar minimization algorithms supported by
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize" title="(in SciPy v0.14.0)"><tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.minimize()</span></tt></a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="18%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#Minimizer.scalar_minimize" title="Minimizer.scalar_minimize"><tt class="xref py py-meth docutils literal"><span class="pre">scalar_minimize()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>method</td>
<td><tt class="docutils literal"><span class="pre">Nelder-Mead</span></tt></td>
<td>fitting method</td>
</tr>
<tr class="row-odd"><td>tol</td>
<td>1.e-7</td>
<td>fitting and parameter tolerance</td>
</tr>
<tr class="row-even"><td>hess</td>
<td>None</td>
<td>Hessian of objective function</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="Minimizer.prepare_fit">
<tt class="descname">prepare_fit</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer.prepare_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>prepares and initializes model and Parameters for subsequent
fitting. This routine prepares the conversion of <tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt>
into fit variables, organizes parameter bounds, and parses, checks and
&#8220;compiles&#8221; constrain expressions.</p>
<p>This is called directly by the fitting methods, and it is generally not
necessary to call this function explicitly.  An exception is when you
would like to call your function to minimize prior to running one of the
minimization routines, for example, to calculate the initial residual
function.  In that case, you might want to do something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myfit</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span><span class="n">my_residual</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>  <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>

<span class="n">myfit</span><span class="o">.</span><span class="n">prepare_fit</span><span class="p">()</span>
<span class="n">init</span> <span class="o">=</span> <span class="n">my_residual</span><span class="p">(</span><span class="n">p_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="s">&#39;b--&#39;</span><span class="p">)</span>

<span class="n">myfit</span><span class="o">.</span><span class="n">leastsq</span><span class="p">()</span>
</pre></div>
</div>
<p>That is, this method should be called prior to your fitting function being called.</p>
</dd></dl>

</div>
<div class="section" id="getting-and-printing-fit-reports">
<h2>Getting and Printing Fit Reports<a class="headerlink" href="#getting-and-printing-fit-reports" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="Minimizer.fit_report">
<tt class="descname">fit_report</tt><big>(</big><em>params</em>, <em>modelpars=None</em>, <em>show_correl=True</em>, <em>min_correl=0.1</em><big>)</big><a class="headerlink" href="#Minimizer.fit_report" title="Permalink to this definition">¶</a></dt>
<dd><p>generate and return text of report of best-fit values, uncertainties,
and correlations from fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> &#8211; Parameters from fit, or Minimizer object as returned by <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>.</li>
<li><strong>modelpars</strong> &#8211; Parameters with &#8220;Known Values&#8221; (optional, default None)</li>
<li><strong>show_correl</strong> &#8211; whether to show list of sorted correlations [<tt class="docutils literal"><span class="pre">True</span></tt>]</li>
<li><strong>min_correl</strong> &#8211; smallest correlation absolute value to show [0.1]</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If the first argument is a Minimizer object, as returned from
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>, the report will include some goodness-of-fit statistics.</p>
</dd></dl>

<dl class="function">
<dt id="Minimizer.report_fit">
<tt class="descname">report_fit</tt><big>(</big><em>params</em>, <em>modelpars=None</em>, <em>show_correl=True</em>, <em>min_correl=0.1</em><big>)</big><a class="headerlink" href="#Minimizer.report_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>print text of report from <a class="reference internal" href="#Minimizer.fit_report" title="Minimizer.fit_report"><tt class="xref py py-func docutils literal"><span class="pre">fit_report()</span></tt></a>.</p>
</dd></dl>

<p>An example fit with report would be</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#&lt;examples/doc_withreport.py&gt;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="kn">import</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">fit_report</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sign</span>


<span class="n">p_true</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="n">p_true</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">14.0</span><span class="p">)</span>
<span class="n">p_true</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.46</span><span class="p">)</span>
<span class="n">p_true</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.123</span><span class="p">)</span>
<span class="n">p_true</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;decay&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.032</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">()</span>
    <span class="n">amp</span> <span class="o">=</span>  <span class="n">vals</span><span class="p">[</span><span class="s">&#39;amp&#39;</span><span class="p">]</span>
    <span class="n">per</span> <span class="o">=</span>  <span class="n">vals</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s">&#39;shift&#39;</span><span class="p">]</span>
    <span class="n">decay</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s">&#39;decay&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">sign</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x</span><span class="o">/</span><span class="n">per</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">decay</span><span class="o">*</span><span class="n">decay</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1001</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">250.0</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.7215</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">x</span>     <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">data</span>  <span class="o">=</span> <span class="n">residual</span><span class="p">(</span><span class="n">p_true</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="n">fit_params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">13.0</span><span class="p">)</span>
<span class="n">fit_params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fit_params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">fit_params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;decay&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">kws</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>

<span class="n">fit</span> <span class="o">=</span> <span class="n">residual</span><span class="p">(</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fit_report</span><span class="p">(</span><span class="n">fit_params</span><span class="p">))</span>

<span class="c">#&lt;end of examples/doc_withreport.py&gt;</span>
</pre></div>
</div>
<p>which would write out:</p>
<div class="highlight-python"><div class="highlight"><pre>[[Variables]]
    amp:      13.9121944 +/- 0.141202 (1.01%) (init= 13)
    decay:    0.03264538 +/- 0.000380 (1.16%) (init= 0.02)
    period:   5.48507044 +/- 0.026664 (0.49%) (init= 2)
    shift:    0.16203677 +/- 0.014056 (8.67%) (init= 0)
[[Correlations]] (unreported correlations are &lt;  0.100)
    C(period, shift)             =  0.797
    C(amp, decay)                =  0.582
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="model.html" title="Modeling Data and Curve Fitting"
             >next</a> |</li>
        <li class="right" >
          <a href="parameters.html" title="Parameter and Parameters"
             >previous</a> |</li>
   <li>[<a href="intro.html">intro</a>|</li>
   <li><a href="parameters.html">parameters</a>|</li>
   <li><a href="#"> minimize</a>|</li>
   <li><a href="model.html"> model</a>|</li>
   <li><a href="builtin_models.html"> builtin models</a>|</li>
   <li><a href="confidence.html">confidence intervals</a>|</li>
   <li><a href="bounds.html">bounds</a>|</li>
   <li><a href="constraints.html">constraints</a>]</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Matthew Newville, The University of Chicago,  Till Stensitzki, Freie Universitat Berlin.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>